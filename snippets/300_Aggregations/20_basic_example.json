# Register the taxis demo repository
PUT /_snapshot/taxis
{
  "type": "url",
  "settings": {
    "url": "http://download.elastic.co/definitiveguide/taxis_demo/"
  }
}

# Inspect the repo to see what snapshots are available
GET /_snapshot/taxis/_all

# Begin the Restore process
POST /_snapshot/taxis/snapshot/_restore

# Monitor the restore process as shards download
GET /taxis/_recovery

# Run a simple search to explore the data
GET taxis/_search

# Basic aggregation - rides per taxi vendor
GET /taxis/_search
{
    "size" : 0,
    "aggs" : {
        "rides_per_vendor" : {
            "terms" : {
              "field" : "vendor"
            }
        }
    }
}


# Find the average revenue per vendor
GET /taxis/_search
{
   "size" : 0,
   "aggs": {
      "vendors": {
         "terms": {
            "field": "vendor"
         },
         "aggs": {
            "avg_revenue": {
               "avg": {
                  "field": "total_amount"
               }
            }
         }
      }
   }
}


# Nest a second bucket to determine passenger count per vendor
GET /taxis/_search
{
   "size" : 0,
   "aggs": {
      "vendors": {
         "terms": {
            "field": "vendor"
         },
         "aggs": {
            "avg_revenue": {
               "avg": {
                  "field": "total_amount"
               }
            },
            "passengers": {
              "terms": {
                "field": "passenger_count"
              }
            }
         }
      }
   }
}

# Finally, add some extra metrics to determine min/max tip per-vendor, per-passenger count
GET /taxis/_search
{
  "size": 0,
  "aggs": {
    "vendors": {
      "terms": {
        "field": "vendor"
      },
      "aggs": {
        "avg_revenue": {
          "avg": {
            "field": "total_amount"
          }
        },
        "passengers": {
          "terms": {
            "field": "passenger_count"
          },
          "aggs": {
            "min_tip": { "min": { "field": "tip_amount" } },
            "max_tip": { "max": { "field": "tip_amount" } }
          }
        }
      }
    }
  }
}